<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <style>
    dialog { z-index: 2; }

    div {
      position: relative;
      z-index: 0;
    }

    section {
      display: flex;
      flex-direction: column;
      max-width: 300px;
      overflow: auto;
      padding: 1rem;
      gap: 1rem;
    }

    i {
      cursor: pointer;
      position: absolute;
      right: 1rem;
      z-index: 1;
    }
  </style>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-green.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
</head>
<body>

  <dialog class="mdl-dialog">
    <h4 class="mdl-dialog__title">Title</h4>
    <div class="mdl-dialog__content">Content</div>
    <div class="mdl-dialog__actions">
      <button type="button" class="mdl-button">OK</button>
    </div>
  </dialog>

  <form id="myForm">
    <section>
      <div>
        <i
          class="material-icons mdl-button--accent"
          onclick="help(event, 'App URL')"
          title="<p>Your apps script url. This is used for the <b>action</b> attribue on your HTML form.</p>">
          help
        </i>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <label
            for="app-url"
            class="mdl-textfield__label">
            App URL
          </label>

          <input
            readonly
            type="url"
            name="appUrl"
            id="app-url"
            class="mdl-textfield__input"
            value="<?= appUrl ?>"
          >
          <span class="mdl-textfield__error">Must be a URL</span>
        </div>
      </div>

      <div>
        <i
          class="material-icons mdl-button--accent"
          onclick="help(event, 'Sheet')"
          title="<p>The name of the sheet in which to store the results.</p>">
          help
        </i>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <label
            for="sheet-name"
            class="mdl-textfield__label">
            Sheet Name
          </label>

          <input
            type="string"
            name="sheetName"
            id="sheet-name"
            class="mdl-textfield__input"
            value="<?= sheetName ?>"
          >
        </div>
      </div>

      <div>
        <i
          class="material-icons mdl-button--accent"
          onclick="help(event, 'Group Email')"
          title="<p>The email address of the Google Group (mailing list) to which you invite contacts who wish to join.</p><p>If you do not want to send invitations to join, leave this field blank.</p><p>You must have an existing Google Group and a checkbox input named <b>mailingList</b> in your HTML form for this to work</p>" >
          help
        </i>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <label
            for="group-email"
            class="mdl-textfield__label">
            Group Email
          </label>
          <input
            type="email"
            id="group-email"
            name="groupEmail"
            class="mdl-textfield__input"
            value="<?= groupEmail ?>">

          <span class="mdl-textfield__error">Must be an email address</span>
        </div>
      </div>

      <div>
        <i
          class="material-icons mdl-button--accent"
          onclick="help(event, 'Success Message')"
          title="<p>The message to send back to the client upon a successful form submission.</p>">
          help
        </i>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <label
            for="success-message"
            class="mdl-textfield__label">
            Success Message
          </label>
          <input
            type="text"
            id="success-message"
            name="successMessage"
            class="mdl-textfield__input"
            value="<?= successMessage ?>" >
        </div>
      </div>

      <div>
        <i
          class="material-icons mdl-button--accent"
          onclick="help(event, 'Error Message')"
          title="<p>The message to send back to the client when an error occurs and <b>Debug</b> is unchecked</p>">
          help
        </i>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <label
            for="error-message"
            class="mdl-textfield__label">
            Error Message
          </label>
          <input
            type="text"
            id="error-message"
            name="errorMessage"
            class="mdl-textfield__input"
            value="<?= errorMessage ?>" >
        </div>
      </div>

      <fieldset class="add-contact">
        <legend>
          Add Contact
          <i
            class="material-icons mdl-button--accent"
            onclick="help(event, 'Add Contact')"
            title="<p>Whether to add the person submitting the form to your Google Contacts.</p>">
            help
          </i>
        </legend>
        <label class="mdl-radio mdl-js-radio" for="add-contact-yes">
          <input
            <?= addContact ? "checked" : "" ?>
            type="radio"
            id="add-contact-yes"
            name="addContact"
            value="yes"
            class="mdl-radio__button">
          <span class="mdl-radio__label">Yes</span>
        </label>

        <label class="mdl-radio mdl-js-radio" for="add-contact-no">
          <input
            <?= addContact ? "" : "checked" ?>
            type="radio"
            id="add-contact-no"
            name="addContact"
            value=""
            class="mdl-radio__button">
          <span class="mdl-radio__label">No</span>
        </label>
      </fieldset>

      <fieldset class="de-bug">
        <legend>
          Debug
          <i
            class="material-icons mdl-button--accent"
            onclick="help(event, 'Debug')"
            title="<p>Whether to send discrete error messages back to the client instead of the generic <b>Error Message</b>.</p>">
            help
          </i>
        </legend>
        <label class="mdl-radio mdl-js-radio" for="debug-yes">
          <input
            <?= debug ? "checked" : "" ?>
            type="radio"
            id="debug-yes"
            name="debug"
            value="yes"
            class="mdl-radio__button">
          <span class="mdl-radio__label">Yes</span>
        </label>

        <label class="mdl-radio mdl-js-radio" for="debug-no">
          <input
            <?= debug ? "" : "checked" ?>
            type="radio"
            id="debug-no"
            name="debug"
            value=""
            class="mdl-radio__button">
          <span class="mdl-radio__label">No</span>
        </label>
      </fieldset>

      <p>
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary">
          Save
        </button>
      </p>
    </section>
  </form>

  <output></output>

  <script>

    function onSuccess(numUnread) {
      google.script.host.close();
    }

    function onFailure(error) {
      var div = document.getElementById('output');
      div.innerHTML = `<h3>Error:</h3><p>${error.message}</p>`;
    }

    document.getElementById("myForm").addEventListener("submit", function(event) {
      event.preventDefault();
      google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onFailure)
      .saveVariables(event.target)
    });

    document.querySelector("dialog button").
    addEventListener("click", function(event) {
      event.target.closest('dialog').close();
    });
  </script>

  <script>
    function help(event, title) {
      const dialog = document.querySelector('dialog');
      const msgContainer = dialog.querySelector('.mdl-dialog__content');
      const titleContainer = dialog.querySelector('.mdl-dialog__title');
      const content = event.target.title;
      titleContainer.textContent = title;
      msgContainer.innerHTML = content;
      dialog.show();
    }
  </script>
</body>
</html>
